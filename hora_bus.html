<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="https://avatars.githubusercontent.com/u/39920231?v=4">
    <title>Horários de Viagem - LuizDNGomes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #333;
        }
        .foto-perfil {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .sino-btn {
            margin-left: 8px;
            background: none;
            border: none;
            color: #0077B5;
            font-size: 18px;
            padding: 2px 4px;
            display: inline-flex;
            align-items: center;
            vertical-align: middle;
            line-height: 1;
        }
        .alerta-proximo {
            cursor: pointer;
            margin-left: 10px;
            background: none;
            border: none;
            color: #0077B5;
            font-size: 18px;
            vertical-align: middle;
            padding: 2px 6px;
            display: inline-flex;
            align-items: center;
            transition: background-color 0.3s;
            border-radius: 4px;
        }
        .alerta-proximo:hover, .alerta-proximo:active {
            color: #004c73;
            background-color: rgba(0, 119, 181, 0.1);
        }
        @media (hover: none) {
            .sino-btn:active, .alerta-proximo:active {
                background-color: rgba(0, 119, 181, 0.2);
                transform: scale(1.2);
            }
        }
        .horario-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
            cursor: pointer;
            padding: 12px 15px;
            border-radius: 6px;
            transition: background-color 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            background-color: #f9f9f9;
        }
        .horario-item:hover {
            background-color: #e9ecef;
        }
        .horario-item:active {
            background-color: #d2d8de;
        }
        .horario-texto {
            flex: 1;
            padding: 0;
            cursor: pointer;
            font-weight: 500;
        }
        .info-notificacao {
            background-color: #f8f9fa;
            border-left: 4px solid #0077B5;
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            color: #333;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .notificacao-feedback {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 119, 181, 0.9);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 16px;
            z-index: 1000;
            max-width: 90%;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            animation: fadeInOut 3s forwards;
            display: none;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, 20px); }
            10% { opacity: 1; transform: translate(-50%, 0); }
            90% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }

.foto-perfil img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
        h1 {
            text-align: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #ffffff;
        }
        .aviso-transporte {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        font-size: 14px;
        font-weight: bold;
        color: #ddd; /* Um laranja avermelhado para dar destaque */
        }
        .container {
            background-color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            border-radius: 5px;
            max-width: 700px;
            margin: auto;
            box-sizing: border-box;
        }
        .horario-atual {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #ddd;
            border-radius: 5px;
        }
        .rota {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
            background-color: #eee;
        }
        .rota strong {
            font-size: 16px;
        }
        .sem-viagem {
            color: red;
            font-weight: bold;
        }
        input, button {
            padding: 10px 20px;
            margin: 5px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            width: 170px;
            background: linear-gradient(45deg, #0077B5, #004c73);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-sizing: border-box;
        }
        button:hover {
            transform: scale(1.012);
            box-shadow: 0px 4px 10px rgba(0, 119, 181, 0.5);
        }
        /* Responsividade geral */
        @media (max-width: 800px) {
            .container {
                max-width: 98vw;
                padding: 10px;
            }
            input, button {
                width: 100%;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                margin: 8px 0;
                font-size: 18px;
            }
        }
        @media (max-width: 500px) {
            body {
                margin: 5px;
            }
            h1, h2 {
                font-size: 1.3em;
            }
            .container {
                padding: 10px;
                border-radius: 8px;
            }
            .horario-atual {
                font-size: 1em;
                padding: 10px;
            }
            .rota {
                font-size: 0.95em;
                padding: 12px;
            }
            input, button {
                font-size: 1em;
                padding: 12px 0;
            }
            .sino-btn, .alerta-proximo {
                font-size: 18px;
                padding: 2px 4px;
            }
            .horario-item {
                padding: 12px;
                margin-bottom: 10px;
            }
            .info-notificacao {
                padding: 15px 10px;
                font-size: 15px;
                margin: 15px 0;
            }
        }
        /* Rodapé responsivo */
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px 10px;
            background-color: #333;
            color: white;
        }
        .footer-creditos {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .footer-links {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .footer-links a img {
            height: 36px;
            margin: 0 2px;
        }
        @media (max-width: 600px) {
            .footer-creditos {
                font-size: 1em;
            }
            .footer-links {
                gap: 6px;
            }
            .footer-links a img {
                height: 28px;
            }
        }
        .aviso-dinamico-custom {
            display: none;
            background: #fff;
            color: #7a5a00;
            font-weight: bold;
            text-align: center;
            padding: 12px 8px;
            font-size: 18px;
            border-radius: 0 0 8px 8px;
            margin: 20px auto 20px auto;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            max-width: 700px;
            width: 100%;
            box-sizing: border-box;
        }
        
        /* Espaçamento específico para o widget meteorológico */
        #ww_d18048fa7c915 {
            margin-bottom: 20px;
        }
        .aviso-dinamico-custom::before {
            content: "";
            display: block;
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 8px;
            background: #d32f2f;
            border-radius: 8px 0 0 8px;
        }
        @media (max-width: 800px) {
            .aviso-dinamico-custom {
                max-width: 98vw;
                padding: 10px 4px;
                font-size: 18px;
            }
        }
        @media (max-width: 600px) {
            .aviso-dinamico-custom {
                font-size: 1em;
                padding: 10px 4px;
            }
            .aviso-dinamico-custom::before {
                width: 5px;
            }
            .notificacao-feedback {
                padding: 15px 15px;
                font-size: 16px;
                border-radius: 30px;
                max-width: 85%;
                bottom: 30px;
            }
        }
    </style>
</head>
<body>
<div id="ww_d18048fa7c915" v='1.3' loc='id' a='{"t":"ticker","lang":"pt","sl_lpl":1,"ids":["wl4914"],"font":"Arial","sl_ics":"one_a","sl_sot":"celsius","cl_bkg":"image","cl_font":"#FFFFFF","cl_cloud":"#FFFFFF","cl_persp":"#81D4FA","cl_sun":"#FFC107","cl_moon":"#FFC107","cl_thund":"#FF5722"}'>Fonte de dados meteorológicos: <a href="https://wetterlang.de" id="ww_d18048fa7c915_u" target="_blank">Wetter 30 tage</a></div><script async src="https://app3.weatherwidget.org/js/?id=ww_d18048fa7c915"></script><!-- AVISO DINÂMICO -->
<div id="aviso-dinamico" class="aviso-dinamico-custom"></div>
<div class="container">
    <h2>Horários de Viagem</h2>
    <label>Data: <input type="date" id="data"></label>
    <label>Hora: <input type="time" id="hora"></label><br>
    <button onclick="usarHoraAtual()">Hora Atual</button>
    <button onclick="procurarViagens()">Planejar Viagem</button>
    <input type="text" id="buscaRota" placeholder="Buscar rota (ex: Ilhota, Gaspar...)" style="width:98%;margin:8px 0 12px 0;padding:10px;border-radius:8px;border:1px solid #ccc;font-size:16px;">
    <!-- esse é o botão de busca para filtrar as rotas -->


    <div id="horarioAtual" class="horario-atual"></div>
    <div id="resultado"></div>
    <div id="notificacao-feedback" class="notificacao-feedback"></div>
</div>

<script>
// Texto do aviso dinâmico - pode ser atualizado conforme necessário
    const textoAviso = "";


    const avisoDiv = document.getElementById('aviso-dinamico');
    if (textoAviso && textoAviso.trim() !== "") {
        avisoDiv.textContent = textoAviso;
        avisoDiv.style.display = "block";
    } else {
        avisoDiv.style.display = "none";
    }

    const legendas = {
    "1": " Sai do Barracão",
    "2": "Sai ou vai até Porto de Areia",
    "3": "Minas",
    "4": "Sai ou Vai Até Beagle",
    "5": "Sai ou Vai Até Círculo",
    "6": "Sai da Vineplast",
    "7": "Vai Até St Terezinha",
    "8": "Sai Do St Terezinha",
    "9": "Sai do Baú Via Ilhota",
    "10": "Sai de Blumenau Via Ilhota",
    "11": "sai ou vai até Porto de Areia",
    "12": "Minas",
    "13": "Sai ou Vai Até Círculo",
    "14": "Até Círculo",
    "15": "Vai Até Barracão",
    };
<!-- Essas legendas são usadas para descrever observações específicas dos horários de viagem. -->


    const horarios = {
        uteis: {
            "Gaspar -> Blumenau": [
                {hora: "03:35"}, {hora: "04:20"}, {hora: "05:05"}, {hora: "05:40"},
                {hora: "05:50"}, {hora: "06:15", obs: "1"}, {hora: "07:05"},
                {hora: "08:30"}, {hora: "10:15"}, {hora: "11:35"}, {hora: "12:00"},
                {hora: "13:25"}, {hora: "14:10"}, {hora: "14:45"}, {hora: "15:55"},
                {hora: "16:30"}, {hora: "16:45"}, {hora: "17:00", obs: "1"},
                {hora: "19:45"}, {hora: "20:15"}, {hora: "22:05"}
            ],
            "Blumenau -> Gaspar": [
                {hora: "04:10"}, {hora: "05:15", obs: "15"}, {hora: "05:50"}, {hora: "06:30"},
                {hora: "07:30"}, {hora: "08:45"}, {hora: "09:15"}, {hora: "10:35"},
                {hora: "11:35"}, {hora: "12:30"}, {hora: "13:40"}, {hora: "14:30"},
                {hora: "15:00"}, {hora: "15:50", obs: "15"}, {hora: "17:10"}, {hora: "17:40"},
                {hora: "18:30"}, {hora: "19:45"}, {hora: "21:00"}, {hora: "22:07", obs: "15"},
                {hora: "22:45"}
            ],
            "Gaspar -> Ilhota": [
                {hora: "05:10", obs: "5"}, {hora: "06:15", obs: "4"},
                {hora: "16:00", obs: "5"}, {hora: "22:10", obs: "2,3,6"}
            ],
            "Ilhota -> Gaspar": [
                {hora: "04:00", obs: "2,5"}, {hora: "14:30", obs: "5"},
                {hora: "18:40", obs: "5"}
            ],
            "Ilhota -> Blumenau": [
                {hora: "05:50", obs: "2"}, {hora: "06:20"}, {hora: "07:10"},
                {hora: "09:00"}, {hora: "10:45"}, {hora: "11:40", obs: "3"}, {hora: "12:14"},
                {hora: "13:00"}, {hora: "14:50"}, {hora: "16:50"}, {hora: "18:05"}, {hora: "21:00"}
            ],
            "Blumenau -> Ilhota": [
                {hora: "06:45"}, {hora: "08:00"}, {hora: "10:00"}, {hora: "11:10"},
                {hora: "12:00", obs: "2"}, {hora: "13:10", obs: "2"}, {hora: "16:25", obs: "2"},
                {hora: "17:20"}, {hora: "18:05"}, {hora: "19:00"}, {hora: "22:10"}
            ],
            "Círculo -> St. Terezinha": [
                {hora: "12:45", obs: "7"}, {hora: "22:00", obs: "8"}
            ],
            "Baú -> Blumenau": [{hora: "05:35", obs: "9"}],
            "Blumenau -> Baú": [{hora: "12:00", obs: "10"}]
        },
        sabado: {
            "Gaspar -> Blumenau": [
                {hora: "03:35"}, {hora: "04:20"}, {hora: "05:05"}, {hora: "06:20"},
                {hora: "07:05"}, {hora: "09:00"}, {hora: "11:05"}, {hora: "12:10"}
            ],
            "Blumenau -> Gaspar": [
                {hora: "04:12"}, {hora: "05:15"}, {hora: "06:20"}, {hora: "07:15"},
                {hora: "07:50"}, {hora: "10:30"}, {hora: "12:10"}, {hora: "13:00"}
            ],
            "Gaspar -> Ilhota": [
                {hora: "05:10", obs: "11,13"}, {hora: "13:15", obs: "11,12,13"}
            ],
            "Ilhota -> Gaspar": [
                {hora: "04:00", obs: "11,13"}, {hora: "11:00", obs: "13"}
            ],
            "Ilhota -> Blumenau": [
                {hora: "07:00", obs: "12"}, {hora: "07:30"}, {hora: "12:45"}
            ],
            "Blumenau -> Ilhota": [
                {hora: "08:40"}, {hora: "14:15"}
            ]
        },
        domingo: {
            "Blumenau -> Gaspar": [{hora: "21:00", obs: "14"}],
            "Ilhota -> Gaspar": [{hora: "21:00", obs: "14"}]
        }
    };

    function detectarTipoDia(data) {
        const dia = new Date(data).getDay();
        if (dia === 6) return 'domingo';
        if (dia === 5) return 'sabado';
        return 'uteis';
    }

    function gerarLegenda(obs) {
        if (!obs) return "";
        const lista = obs.split(',').map(o => o.trim()).map(o => legendas[o] || `Obs ${o}`);
        return lista.join('; ');
    }

    function usarHoraAtual() {
        const agora = new Date();
        const data = agora.toISOString().split('T')[0];
        const hora = agora.getHours().toString().padStart(2, '0') + ':' +
                     agora.getMinutes().toString().padStart(2, '0');

        document.getElementById('data').value = data;
        document.getElementById('hora').value = hora;
    }

    function procurarViagens() {
        const data = document.getElementById('data').value;
        const hora = document.getElementById('hora').value;
        const busca = document.getElementById('buscaRota').value.trim().toLowerCase();
        const resultadoDiv = document.getElementById('resultado');
        const horarioAtualDiv = document.getElementById('horarioAtual');

        if (!data || !hora) {
            resultadoDiv.innerHTML = '<p style="color:red;">Data e hora não informada.</p>';
            return;
        }

        const tipoDia = detectarTipoDia(data);
        const rotas = horarios[tipoDia] || {};

        horarioAtualDiv.innerHTML = `Data: ${data} - Hora: ${hora} (${tipoDia.toUpperCase()})`;

        resultadoDiv.innerHTML = '';

        for (const [rota, lista] of Object.entries(rotas)) {
            if (busca && !rota.toLowerCase().includes(busca)) continue;

            const div = document.createElement('div');
            div.className = 'rota';

            const btn = document.createElement('button');
            btn.type = 'button';
            btn.style.marginRight = '8px';
            btn.style.width = '32px';
            btn.style.padding = '0 8px';
            btn.style.background = 'none';
            btn.style.color = '#333';
            btn.style.fontSize = '20px';
            btn.style.cursor = 'pointer';
            btn.style.border = 'none';
            btn.style.verticalAlign = 'middle';
            btn.innerHTML = '▼';

            const header = document.createElement('span');
            header.style.fontWeight = 'bold';
            header.style.fontSize = '16px';
            header.textContent = rota;
            
            const alertaProximo = document.createElement('span');
            alertaProximo.className = 'alerta-proximo';
            alertaProximo.innerHTML = '🔔';
            alertaProximo.title = 'Receber alerta para próximo horário';
            alertaProximo.setAttribute('aria-label', 'Alerta próximo horário');
            alertaProximo.onclick = function() {
                const futuros = lista.filter(h => h.hora >= hora).sort((a, b) => a.hora.localeCompare(b.hora));
                if (futuros.length > 0) {
                    const proximoHorario = futuros[0].hora;
                    configurarAlerta(rota, proximoHorario);
                } else {
                    mostrarFeedback('Não há mais horários disponíveis para hoje nesta rota.');
                }
            };

            const horariosDiv = document.createElement('div');
            horariosDiv.style.marginTop = '8px';

            const futuros = lista.filter(h => h.hora >= hora).sort((a, b) => a.hora.localeCompare(b.hora));

            if (futuros.length > 0) {
                futuros.forEach(item => {
                    const itemContainer = document.createElement('div');
                    itemContainer.className = 'horario-item';
                    itemContainer.title = 'Toque para receber alerta para este horário';
                    
                    const horarioSpan = document.createElement('span');
                    horarioSpan.className = 'horario-texto';
                    const legenda = gerarLegenda(item.obs);
                    
                    horarioSpan.innerHTML = legenda ? `${item.hora} - ${legenda}` : `${item.hora}`;
                    
                    // Cria ícone de sino (agora é apenas visual)
                    const sinoSpan = document.createElement('span');
                    sinoSpan.className = 'sino-btn';
                    sinoSpan.innerHTML = '🔔';
                    sinoSpan.setAttribute('aria-label', 'Receber notificação');
                    
                    // Adiciona ao container de item
                    itemContainer.appendChild(horarioSpan);
                    itemContainer.appendChild(sinoSpan);
                    
                    // Todo o container é clicável
                    itemContainer.onclick = function() {
                        configurarAlerta(rota, item.hora);
                    };
                    
                    horariosDiv.appendChild(itemContainer);
                });
            } else {
                horariosDiv.innerHTML += '<span class="sem-viagem">Não há mais viagens para a hora e data selecionada.</span>';
            }

            btn.onclick = function () {
                if (horariosDiv.style.display === 'none') {
                    horariosDiv.style.display = '';
                    btn.innerHTML = '▼';
                } else {
                    horariosDiv.style.display = 'none';
                    btn.innerHTML = '►';
                }
            };

            div.appendChild(btn);
            div.appendChild(header);
            div.appendChild(alertaProximo);
            div.appendChild(document.createElement('br'));
            div.appendChild(horariosDiv);

            resultadoDiv.appendChild(div);
        }
    }

    document.getElementById('buscaRota').addEventListener('input', procurarViagens);

    function mostrarFeedback(mensagem, duracao = 3000) {
        const feedback = document.getElementById('notificacao-feedback');
        feedback.textContent = mensagem;
        feedback.style.display = 'block';
        
        feedback.style.animation = 'none';
        feedback.offsetHeight;
        feedback.style.animation = 'fadeInOut ' + (duracao/1000) + 's forwards';
        
        setTimeout(() => {
            feedback.style.display = 'none';
        }, duracao);
    }

    function isDispositivoMovel() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    function solicitarPermissaoNotificacao() {
        if (!("Notification" in window)) {
            mostrarFeedback("Este dispositivo não suporta notificações");
            return false;
        } else if (Notification.permission === "granted") {
            return true;
        } else if (Notification.permission !== "denied") {
            Notification.requestPermission().then(function (permission) {
                if (permission === "granted") {
                    mostrarFeedback("Notificações ativadas com sucesso!");
                    return true;
                } else {
                    mostrarFeedback("Notificações não foram permitidas");
                    return false;
                }
            });
        }
        return Notification.permission === "granted";
    }

    function configurarAlerta(rota, horario) {
        if (!solicitarPermissaoNotificacao()) {
            mostrarFeedback("❌ Você precisa permitir notificações para receber alertas");
            setTimeout(() => {
                if (confirm("Deseja habilitar as notificações agora?")) {
                    solicitarPermissaoNotificacao();
                }
            }, 1000);
            return;
        }

        const mensagem = `Rota: ${rota}\nO ônibus do horário: ${horario} saiu do ponto final.`;
        
        const agora = new Date();
        const [horas, minutos] = horario.split(':').map(Number);
        const horaProgramada = new Date(agora);
        
        horaProgramada.setHours(horas, minutos, 0);
        
        if (horaProgramada < agora) {
            mostrarFeedback("⚠️ Este horário já passou");
            return;
        }
        
        const tempoAteHorario = horaProgramada.getTime() - agora.getTime();
        
        const minutosAteHorario = Math.floor(tempoAteHorario / 60000);
        const horasAteHorario = Math.floor(minutosAteHorario / 60);
        const minutosRestantes = minutosAteHorario % 60;
        
        let tempoFormatado = '';
        if (horasAteHorario > 0) {
            tempoFormatado = `${horasAteHorario}h ${minutosRestantes}min`;
        } else {
            tempoFormatado = `${minutosRestantes} minutos`;
        }
        
        mostrarFeedback(`✓ Alerta programado: ${rota} às ${horario} (em ${tempoFormatado})`, 4000);
        
        try {
            const alertasSalvos = JSON.parse(localStorage.getItem('alertasOnibus') || '[]');
            const novoAlerta = {
                rota: rota,
                horario: horario,
                timestamp: horaProgramada.getTime()
            };
            alertasSalvos.push(novoAlerta);
            localStorage.setItem('alertasOnibus', JSON.stringify(alertasSalvos));
        } catch (e) {
            console.error("Erro ao salvar alerta:", e);
        }
        
        setTimeout(() => {
            try {
                if (isDispositivoMovel() && navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
                
                const notificacao = new Notification("Alerta de Ônibus", {
                    body: mensagem,
                    icon: "https://avatars.githubusercontent.com/u/39920231?v=4",
                    badge: "https://avatars.githubusercontent.com/u/39920231?v=4",
                    vibrate: [200, 100, 200, 100, 200],
                    tag: `onibus-${rota}-${horario}`,
                    renotify: true
                });
                
                notificacao.onclick = function() {
                    window.focus();
                    this.close();
                };
                
                try {
                    const alertasSalvos = JSON.parse(localStorage.getItem('alertasOnibus') || '[]');
                    const alertasAtualizados = alertasSalvos.filter(alerta => 
                        !(alerta.rota === rota && alerta.horario === horario)
                    );
                    localStorage.setItem('alertasOnibus', JSON.stringify(alertasAtualizados));
                } catch (e) {
                    console.error("Erro ao remover alerta:", e);
                }
            } catch (e) {
                console.error("Erro ao exibir notificação:", e);
            }
        }, tempoAteHorario);
    }

    window.addEventListener('load', function() {
        if (Notification.permission === "granted") {
            mostrarFeedback("Notificações estão ativadas", 2000);
        } else if (Notification.permission !== "denied") {
            if (isDispositivoMovel()) {
                const infoDiv = document.querySelector('.info-notificacao');
                const btnPermissao = document.createElement('button');
                btnPermissao.innerHTML = '🔔 Permitir Notificações';
                btnPermissao.style.backgroundColor = '#0077B5';
                btnPermissao.style.color = 'white';
                btnPermissao.style.border = 'none';
                btnPermissao.style.padding = '12px 20px';
                btnPermissao.style.borderRadius = '25px';
                btnPermissao.style.fontSize = '16px';
                btnPermissao.style.margin = '10px auto';
                btnPermissao.style.display = 'block';
                btnPermissao.style.cursor = 'pointer';
                btnPermissao.onclick = solicitarPermissaoNotificacao;
                infoDiv.appendChild(btnPermissao);
            } else {
                solicitarPermissaoNotificacao();
            }
        }
        
        try {
            const alertasSalvos = JSON.parse(localStorage.getItem('alertasOnibus') || '[]');
            const agora = new Date().getTime();
            
            const alertasFuturos = alertasSalvos.filter(alerta => alerta.timestamp > agora);
            
            if (alertasFuturos.length > 0) {
                mostrarFeedback(`Você tem ${alertasFuturos.length} alerta(s) programado(s)`, 3000);
                
                alertasFuturos.forEach(alerta => {
                    const tempoRestante = alerta.timestamp - agora;
                    
                    setTimeout(() => {
                        const notificacao = new Notification("Alerta de Ônibus", {
                            body: `Rota: ${alerta.rota}\nO ônibus do horário: ${alerta.horario} saiu do ponto final.`,
                            icon: "https://avatars.githubusercontent.com/u/39920231?v=4",
                            badge: "https://avatars.githubusercontent.com/u/39920231?v=4",
                            vibrate: [200, 100, 200, 100, 200],
                            tag: `onibus-${alerta.rota}-${alerta.horario}`,
                            renotify: true
                        });
                        
                        if (isDispositivoMovel() && navigator.vibrate) {
                            navigator.vibrate([200, 100, 200]);
                        }
                        
                        notificacao.onclick = function() {
                            window.focus();
                            this.close();
                        };
                        
                        const alertasAtualizados = JSON.parse(localStorage.getItem('alertasOnibus') || '[]')
                            .filter(a => !(a.rota === alerta.rota && a.horario === alerta.horario));
                        localStorage.setItem('alertasOnibus', JSON.stringify(alertasAtualizados));
                    }, tempoRestante);
                });
                
                localStorage.setItem('alertasOnibus', JSON.stringify(alertasFuturos));
            }
        } catch (e) {
            console.error("Erro ao restaurar alertas:", e);
        }
    });

    function compartilharSite() {
        if (navigator.share) {
            navigator.share({
                title: 'Horários de Viagem - LuizDNGomes',
                text: 'Confira os horários de viagem neste site!',
                url: window.location.href
            });
        } else {
            alert('O compartilhamento nativo não é suportado neste dispositivo. Copie o link manualmente: ' + window.location.href);
        }
    }
    
    // Função para limpar todas as notificações programadas
    function limparTodasNotificacoes() {
        try {
            localStorage.removeItem('alertasOnibus');
            mostrarFeedback("✅ Todas as notificações foram canceladas", 3000);
        } catch (e) {
            console.error("Erro ao limpar notificações:", e);
            mostrarFeedback("❌ Erro ao limpar notificações", 3000);
        }
    }
    
    // Função para criar notificação de teste em 1 minuto
    function criarNotificacaoTeste() {
        if (!solicitarPermissaoNotificacao()) {
            mostrarFeedback("❌ Você precisa permitir notificações para receber alertas");
            return;
        }
        
        mostrarFeedback("✓ Notificação de teste agendada para 1 minuto", 3000);
        
        const agora = new Date();
        const umMinutoDepois = new Date(agora.getTime() + 60000);
        
        // Salvar alerta de teste no localStorage
        try {
            const alertasSalvos = JSON.parse(localStorage.getItem('alertasOnibus') || '[]');
            const novoAlerta = {
                rota: "TESTE",
                horario: "Agora",
                timestamp: umMinutoDepois.getTime()
            };
            alertasSalvos.push(novoAlerta);
            localStorage.setItem('alertasOnibus', JSON.stringify(alertasSalvos));
        } catch (e) {
            console.error("Erro ao salvar alerta de teste:", e);
        }
        
        // Programar a notificação de teste
        setTimeout(() => {
            try {
                if (isDispositivoMovel() && navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
                
                const notificacao = new Notification("Teste de Notificação", {
                    body: "Este é um teste de notificação. Se você está vendo isso, as notificações estão funcionando corretamente!",
                    icon: "https://avatars.githubusercontent.com/u/39920231?v=4",
                    badge: "https://avatars.githubusercontent.com/u/39920231?v=4",
                    vibrate: [200, 100, 200, 100, 200],
                    tag: "teste-notificacao",
                    renotify: true
                });
                
                notificacao.onclick = function() {
                    window.focus();
                    this.close();
                };
                
                // Remover alerta de teste executado
                try {
                    const alertasSalvos = JSON.parse(localStorage.getItem('alertasOnibus') || '[]');
                    const alertasAtualizados = alertasSalvos.filter(alerta => 
                        !(alerta.rota === "TESTE" && alerta.horario === "Agora")
                    );
                    localStorage.setItem('alertasOnibus', JSON.stringify(alertasAtualizados));
                } catch (e) {
                    console.error("Erro ao remover alerta de teste:", e);
                }
            } catch (e) {
                console.error("Erro ao exibir notificação de teste:", e);
            }
        }, 60000); // 1 minuto = 60000ms
    }
</script>
<footer>
    <div class="footer-creditos">
        <img class="foto-perfil" src="https://avatars.githubusercontent.com/u/39920231?v=4" alt="Foto de LuizDNGomes">
        <h3>📫 Como encontrar o desenvolvedor - LuizDNGomes</h3>

        <div class="footer-links">
            <a href="https://linktr.ee/luizdngomes" target="_blank">
                <img src="https://img.shields.io/badge/linktree-42e45f?style=for-the-badge&logo=linktree&logoColor=white" alt="Linktree">
            </a>
            <a href="https://www.youtube.com/@BatalhaoWin" target="_blank">
                <img src="https://img.shields.io/badge/YouTube-FF0000?style=for-the-badge&logo=youtube&logoColor=white" alt="YouTube">
            </a>
            <a href="https://www.linkedin.com/in/luizdngomes/" target="_blank">
                <img src="https://img.shields.io/badge/-LinkedIn-%230077B5?style=for-the-badge&logo=linkedin&logoColor=white" alt="LinkedIn">
            </a>
            <a href="https://answers.microsoft.com/pt-br/profile/f12fd1a9-c778-4718-95c7-3dcb12feb2c0" target="_blank">
                <img src="https://img.shields.io/badge/Microsoft Answers-0078D6?style=for-the-badge&logo=windows&logoColor=white" alt="Windows">
            </a>
            <a href="https://api.whatsapp.com/send?phone=5521976623377" target="_blank">
                <img src="https://img.shields.io/badge/WhatsApp-25D366?style=for-the-badge&logo=whatsapp&logoColor=white" alt="WhatsApp">
            </a>
            <a href="https://www.instagram.com/luizdngomes" target="_blank">
                <img src="https://img.shields.io/badge/-Instagram-%23E4405F?style=for-the-badge&logo=instagram&logoColor=white" alt="Instagram">
            </a>
            <a href="mailto:luizdngomes@live.com">
                <img src="https://img.shields.io/badge/-Email-%222222?style=for-the-badge&logo=gmail&logoColor=white" alt="Email">
            </a>
            <a href="https://github.com/luizdngomes" target="_blank">
                <img src="https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=github&logoColor=white" alt="GitHub">
            </a>
            <a href="https://teams.microsoft.com/l/chat/0/0?users=luizdngomes@live.com" target="_blank">
                <img src="https://img.shields.io/badge/Teams-6264A7?style=for-the-badge&logo=microsoftteams&logoColor=white" alt="Teams">
            </a>
        </div>
        
        <p class="aviso-transporte">
            ⚠️ Os horários de viagem informados pela empresa correspondem à saída do ônibus do ponto inicial e estão sujeitos a alterações sem aviso prévio. <br>
            📅 Em feriados, os horários podem sofrer modificações. <br>
            ❗ ESSA APLICAÇÃO NÃO TEM VÍNCULO COM A EMPRESA PRESTADORA DO SERVIÇO DE TRANSPORTE.<br><br>
            🤖 Atualizado em 08/09/2025 - <br>Sistema de notificações otimizado para celulares<br>Toque no sino para ser informado do próximo horário do ônibus ou do horário desejado!
        </p>
        
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 15px 0;">
            <button onclick="limparTodasNotificacoes()" style="padding:10px 15px; border-radius:8px; background:#44cc11; color:white; font-weight:bold; border:none; cursor:pointer; flex: 1; min-width: 150px; max-width: 250px;">
                🧹 Limpar todas as notificações
            </button>
            <button onclick="criarNotificacaoTeste()" style="padding:10px 15px; border-radius:8px; background:#032c88; color:white; font-weight:bold; border:none; cursor:pointer; flex: 1; min-width: 150px; max-width: 250px;">
                🔔 Notificação de teste - 1 min
            </button>
        </div>
        
        <button onclick="compartilharSite()" style="margin-bottom:10px; padding:10px 20px; border-radius:8px; background:#8f9094; color:white; font-weight:bold; border:none; cursor:pointer;">
            📤 Compartilhe!
        </button>
    </div>
    
</footer>
</body>

</html>
